version: 2.1

workflows:
    pull_request:
        jobs:
            - tests:
                context:
                    - docker-hub-credentials
                filters:
                    branches:
                        ignore:
                            - main

jobs:
    tests:
        docker:
            -
                image: cimg/node:current
                auth:
                    username: $DOCKERHUB_USER
                    password: $DOCKERHUB_PASSWORD
                environment:
                    TERM: xterm
        steps:
            - checkout
            - restore_cache:
                keys:
                    - yarn-{{ .Environment.CACHE_VERSION }}-{{ checksum "yarn.lock" }}
                    - yarn-{{ .Environment.CACHE_VERSION }}-
            - run:
                name: Install dependencies
                command: make install
            - save_cache:
                key: yarn-{{ .Environment.CACHE_VERSION }}-{{ checksum "yarn.lock" }}
                paths:
                    - ~/.cache
            - run:
                name: Lint the stylesheets
                command: make stylelint
            - run:
                name: Check the code style
                command: make prettier
            - run:
                name: Lint the TS code
                command: make eslint
